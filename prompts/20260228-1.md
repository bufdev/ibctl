OK, I want to build a CLI tool that helps me analyze my holdings and trades on Interactive Brokers.

## Commands

There's a few commands that I want. We'll start with the basic ones.

### `ibctl download`

Download and cache all necessary data into JSON files into the data directory (which I will reference as `${DATA_DIR}`). I don't want to use any database.

The data directory comes from configuration. You should structure it. Right now, everything should be in `${DATA_DIR}/v1` so that we version this.

Other commands rely on files being present from `ibctl download`. The code to download this data and put it into the data directory should be abstracted into a helper package ie `internal/ibctl/ibctldownload`.

I want you to not just rely on IBKR's statistics. **You should download every tax lot**.

**You should manually compute average price and position from the tax lots**. If IBKR provides such information via the API, verify it matches as part of the download.

You will want information on:

- Existing holdings.
- Trades since the beginning of the account.
- Exchange rates into symbol currencies going back to the beginning of the count to/from USD and CAD.

### `ibctl holdings overview`

This command will use downloaded data and give me details on my holdings. What I want to have:

- Symbol
- Last Price
- Average Price
- Position
- Category
- Type
- Sector

I believe that IBKR calls "Symbol" an "Instrument".

Category, Type, Sector will be empty unless filled out via configuration.

## Configuration

I want a configuration file `ibctl.yaml. The configuration file should be YAML. It should be read from the current directory, or a path specified with `--config`. I want a few additional sub-commands:

- `ibkr config init`: If no configuration file exists, make a new one with every field commented/documented. Error if one already exists.
- `ibkr config validate`: Make sure the configuration file is valid.

A configuration file is *required* for most commands to work, so fail if it does not exist.

These commands also use `--config`, so they will read `ibctl.yaml` from the current directory, otherwise use the path specified by `--config`. So `ibkr config init` will by default error if there is a file in the current directory, or if there is a `--config` flag, error if the file it points to already exists.

The file has the following shape:

```yaml
# The configuration file version.
#
# Required. The only current valid version is v1.
version: v1
# The data directory.
#
# Required.
data: ~/Documents/data
# Symbol configuration.
symbols:
    # The symbol.
  - name: NET
    # The category.
    category: EQUITY
    # The type.
    type: STOCK|BOND|ETF
    # The sector.
    sector: TECH
```

## Notes

For every command, I want a `--format` flag that has three options:

- `table` (default): output in a pretty table in my terminal.
- `csv`: output to CSV. Use reasonable header names.
- `json`: output to JSON. Use reasonable keys.

You'll need to handle tax lots. I am a US citizen, so short vs long-term holdings matter (held for >=1 year) for taxes.

You need to figure out how to use the IBKR API.

## Patterns

Look at ~/git/financemigrate and ~/git/buf for patterns. Use the following structure:

- `internal/standard`: Extensions to the stdlib. Prefix each with `x`. See financemigrate.
- `internal/pkg`: Things that are not stdlib but not ibctl-specific. See financemigrate and buf.
- `internal/ibctl`: Everything really ibctl-specific. For sub-packages, prefix them with `ibctl`, ie `internal/ibctl/ibctldownload`. See buf.
- `cmd/ibctl`: The command. See the financemigrate and buf structure for sub-commands and helpers.
- `internal/gen` contains generated packages. You should never hand-write code in here.
- `cmd/ibctl` packages can import from any `internal` package.
- `internal/ibctl` packages can import from `internal/pkg`, and `internal/standard` packages, but not `cmd` packages.
- `internal/pkg` packages can only import from `internal/pkg` and `internal/standard` packages.
- `internal/standard` packages can only import from other `internal/standard` packages.

That is, the ordering is strictly `cmd -> internal/ibctl -> internal/pkg -> internal/standard`.

For Go code, follow buf and financemigrate. Interface and contructor heavy, functional options, etc. Read your go standards.

I want clean, repeatable code. Make sure to make yourself helper libraries as necessary.

## Documentation

Once complete, the README.md needs to be updated to explain the tool and its usage, and `--help` for each command needs to be effective.
